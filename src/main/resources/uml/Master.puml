@startuml
title EchoNote - Overall Architecture with Design Patterns

skinparam classAttributeIconSize 0

note as DesignPatterns
  **Design Patterns:**
  1. Singleton + Factory - OpenAiClientFactory
  2. Builder - MeetingRecordBuilder
  3. Iterator - MeetingRecordIterator
  4. Proxy - TranscriberProxy
  5. Strategy - MeetingExporter

  **Features:**
  - Persistent Meeting History (Jack)
  - Multi-Format Export (Arpit)
  - Email Draft Flow (Mihail)
end note

package "EchoNote.App" {
    class AppMain
    class AppConfig
    class SwingUI
    class ConsoleUI
}

package "EchoNote.Config" {
    class OpenAiClientFactory <<Singleton, Factory>> {
        - {static} CLIENT : OpenAIClient
        --
        - {static} createClient() : OpenAIClient
        + {static} getClient() : OpenAIClient
    }
}

package "EchoNote.Jack" {
    class Workspace
    class MeetingRecord
    class MeetingRecordBuilder <<Builder>>
    class MeetingRecordCollection <<Aggregate>>
    class MeetingRecordIterator <<Iterator>>
    class Participant
    class Transcript
    class Summary
    class ActionItem

    ' Persistence Feature
    class MeetingStorage
    class MeetingRecordDto
    class StorageException

    enum TranscriptSource
    enum ApprovalStatus
    enum ActionStatus

    enum ExportFormat
    enum ExportDestination
    class ExportResult

    class InvalidEmailException
    class RecordNotFoundException
}

package "EchoNote.Mihail" {
    class Recorder
    interface TranscriptionService <<Subject>>
    class Transcriber <<RealSubject>>
    class TranscriberProxy <<Proxy>>
    class Summarizer
    class TranscriptionException
    class SummarizationException

    ' Email Draft Flow Feature
    class EmailDraftService
    class EmailDraftException
}

package "EchoNote.Arpit" {
    ' Strategy Pattern for Export
    interface MeetingExporter <<Strategy>>
    class MarkdownExporter <<ConcreteStrategy>>
    class HtmlExporter <<ConcreteStrategy>>
    class ExportService <<Context>>

    class SearchService
    interface Notifier
    class EmailNotifier
    class NotificationException
    class UnsupportedExportException
}

AppMain --> AppConfig
AppMain --> SwingUI

AppConfig --> Workspace
AppConfig --> MeetingStorage
AppConfig --> Transcriber
AppConfig --> Summarizer
AppConfig --> ExportService
AppConfig --> SearchService
AppConfig --> EmailDraftService

SwingUI --> Workspace
SwingUI --> Transcriber
SwingUI --> Summarizer
SwingUI --> ExportService
SwingUI --> SearchService
SwingUI --> EmailDraftService
SwingUI --> Recorder

ConsoleUI --> Workspace
ConsoleUI --> ExportService
ConsoleUI --> SearchService
ConsoleUI --> EmailDraftService

OpenAiClientFactory --> Transcriber
OpenAiClientFactory --> Summarizer

' Persistence Feature
Workspace --> MeetingStorage : uses
MeetingStorage --> MeetingRecordDto : serializes
MeetingStorage --> StorageException : throws
MeetingRecordDto --> MeetingRecord : converts

Workspace "1" o-- "*" MeetingRecord

MeetingRecord "1" o-- "*" Participant
MeetingRecord "1" o-- "*" ActionItem
MeetingRecord "1" o-- "0..1" Transcript
MeetingRecord "1" o-- "0..1" Summary

MeetingRecord --> ApprovalStatus
Transcript --> TranscriptSource
ActionItem --> ActionStatus
ActionItem --> Participant

MeetingRecordBuilder --> MeetingRecord
MeetingRecordBuilder --> Participant
MeetingRecordBuilder --> ActionItem
MeetingRecordBuilder --> Transcript
MeetingRecordBuilder --> Summary

ExportResult --> MeetingRecord
ExportResult --> ExportFormat
ExportResult --> ExportDestination

InvalidEmailException --> Participant
RecordNotFoundException --> Workspace

Recorder --> TranscriptionException

' Iterator Pattern
MeetingRecordCollection o-- "*" MeetingRecord
MeetingRecordCollection --> MeetingRecordIterator : creates
MeetingRecordIterator --> MeetingRecord : traverses

' Proxy Pattern
TranscriptionService <|.. Transcriber
TranscriptionService <|.. TranscriberProxy
TranscriberProxy --> TranscriptionService : delegates to

Transcriber --> Transcript
Transcriber --> TranscriptSource
Transcriber --> TranscriptionException

Summarizer --> Transcript
Summarizer --> Summary
Summarizer --> ActionItem
Summarizer --> Participant
Summarizer --> ActionStatus
Summarizer --> SummarizationException

' Strategy Pattern for Export
MeetingExporter <|.. MarkdownExporter
MeetingExporter <|.. HtmlExporter
ExportService o-- "*" MeetingExporter : registers
ExportService --> ExportFormat

SearchService --> Workspace
SearchService --> MeetingRecord

ExportService --> MeetingRecord
ExportService --> ExportResult
ExportService --> Summary
ExportService --> ActionItem
ExportService --> UnsupportedExportException

Notifier --> MeetingRecord

EmailNotifier ..|> Notifier
EmailNotifier --> MeetingRecord
EmailNotifier --> Participant
EmailNotifier --> Summary
EmailNotifier --> ActionItem
EmailNotifier --> NotificationException

' Email Draft Flow Feature
EmailDraftService --> MeetingRecord
EmailDraftService --> Summary
EmailDraftService --> ActionItem
EmailDraftService --> InvalidEmailException
EmailDraftService --> EmailDraftException

@enduml
